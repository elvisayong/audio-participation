{"ast":null,"code":"import axios from 'axios';\nconst api = axios.create({\n  baseURL: 'http://localhost:8000/api',\n  headers: {\n    'Content-Type': 'application/json'\n  }\n});\napi.interceptors.request.use(async config => {\n  let token = localStorage.getItem('token');\n  let refreshToken = localStorage.getItem('refreshToken');\n  const tokenExpiry = localStorage.getItem('tokenExpiry');\n  if (token && refreshToken && tokenExpiry && Date.now() >= tokenExpiry) {\n    try {\n      const response = await axios.post('http://localhost:8000/api/token/refresh/', {\n        refresh: refreshToken\n      });\n      token = response.data.access;\n      localStorage.setItem('token', token);\n      localStorage.setItem('tokenExpiry', Date.now() + response.data.access_expires_in * 1000);\n      config.headers.Authorization = `Bearer ${token}`;\n    } catch (error) {\n      console.error('Error refreshing token', error);\n      localStorage.removeItem('token');\n      localStorage.removeItem('refreshToken');\n      localStorage.removeItem('tokenExpiry');\n      window.location.href = '/';\n    }\n  } else if (token) {\n    config.headers.Authorization = `Bearer ${token}`;\n  }\n  return config;\n}, error => {\n  return Promise.reject(error);\n});\nexport default api;","map":{"version":3,"names":["axios","api","create","baseURL","headers","interceptors","request","use","config","token","localStorage","getItem","refreshToken","tokenExpiry","Date","now","response","post","refresh","data","access","setItem","access_expires_in","Authorization","error","console","removeItem","window","location","href","Promise","reject"],"sources":["C:/Users/awanchiri/audio participation/audio-participation-frontend/src/services/api.js"],"sourcesContent":["import axios from 'axios';\r\n\r\nconst api = axios.create({\r\n    baseURL: 'http://localhost:8000/api',\r\n    headers: {\r\n        'Content-Type': 'application/json',\r\n    },\r\n});\r\n\r\napi.interceptors.request.use(\r\n    async config => {\r\n        let token = localStorage.getItem('token');\r\n        let refreshToken = localStorage.getItem('refreshToken');\r\n        const tokenExpiry = localStorage.getItem('tokenExpiry');\r\n\r\n        if (token && refreshToken && tokenExpiry && Date.now() >= tokenExpiry) {\r\n            try {\r\n                const response = await axios.post('http://localhost:8000/api/token/refresh/', {\r\n                    refresh: refreshToken,\r\n                });\r\n                token = response.data.access;\r\n                localStorage.setItem('token', token);\r\n                localStorage.setItem('tokenExpiry', Date.now() + response.data.access_expires_in * 1000);\r\n                config.headers.Authorization = `Bearer ${token}`;\r\n            } catch (error) {\r\n                console.error('Error refreshing token', error);\r\n                localStorage.removeItem('token');\r\n                localStorage.removeItem('refreshToken');\r\n                localStorage.removeItem('tokenExpiry');\r\n                window.location.href = '/';\r\n            }\r\n        } else if (token) {\r\n            config.headers.Authorization = `Bearer ${token}`;\r\n        }\r\n        return config;\r\n    },\r\n    error => {\r\n        return Promise.reject(error);\r\n    }\r\n);\r\n\r\nexport default api;\r\n"],"mappings":"AAAA,OAAOA,KAAK,MAAM,OAAO;AAEzB,MAAMC,GAAG,GAAGD,KAAK,CAACE,MAAM,CAAC;EACrBC,OAAO,EAAE,2BAA2B;EACpCC,OAAO,EAAE;IACL,cAAc,EAAE;EACpB;AACJ,CAAC,CAAC;AAEFH,GAAG,CAACI,YAAY,CAACC,OAAO,CAACC,GAAG,CACxB,MAAMC,MAAM,IAAI;EACZ,IAAIC,KAAK,GAAGC,YAAY,CAACC,OAAO,CAAC,OAAO,CAAC;EACzC,IAAIC,YAAY,GAAGF,YAAY,CAACC,OAAO,CAAC,cAAc,CAAC;EACvD,MAAME,WAAW,GAAGH,YAAY,CAACC,OAAO,CAAC,aAAa,CAAC;EAEvD,IAAIF,KAAK,IAAIG,YAAY,IAAIC,WAAW,IAAIC,IAAI,CAACC,GAAG,CAAC,CAAC,IAAIF,WAAW,EAAE;IACnE,IAAI;MACA,MAAMG,QAAQ,GAAG,MAAMhB,KAAK,CAACiB,IAAI,CAAC,0CAA0C,EAAE;QAC1EC,OAAO,EAAEN;MACb,CAAC,CAAC;MACFH,KAAK,GAAGO,QAAQ,CAACG,IAAI,CAACC,MAAM;MAC5BV,YAAY,CAACW,OAAO,CAAC,OAAO,EAAEZ,KAAK,CAAC;MACpCC,YAAY,CAACW,OAAO,CAAC,aAAa,EAAEP,IAAI,CAACC,GAAG,CAAC,CAAC,GAAGC,QAAQ,CAACG,IAAI,CAACG,iBAAiB,GAAG,IAAI,CAAC;MACxFd,MAAM,CAACJ,OAAO,CAACmB,aAAa,GAAG,UAAUd,KAAK,EAAE;IACpD,CAAC,CAAC,OAAOe,KAAK,EAAE;MACZC,OAAO,CAACD,KAAK,CAAC,wBAAwB,EAAEA,KAAK,CAAC;MAC9Cd,YAAY,CAACgB,UAAU,CAAC,OAAO,CAAC;MAChChB,YAAY,CAACgB,UAAU,CAAC,cAAc,CAAC;MACvChB,YAAY,CAACgB,UAAU,CAAC,aAAa,CAAC;MACtCC,MAAM,CAACC,QAAQ,CAACC,IAAI,GAAG,GAAG;IAC9B;EACJ,CAAC,MAAM,IAAIpB,KAAK,EAAE;IACdD,MAAM,CAACJ,OAAO,CAACmB,aAAa,GAAG,UAAUd,KAAK,EAAE;EACpD;EACA,OAAOD,MAAM;AACjB,CAAC,EACDgB,KAAK,IAAI;EACL,OAAOM,OAAO,CAACC,MAAM,CAACP,KAAK,CAAC;AAChC,CACJ,CAAC;AAED,eAAevB,GAAG","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}